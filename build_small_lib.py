import os
import re

import config as cfg
accs = ['X17276.1', 'X51700.1', 'X68321.1', 'X55027.1', 'Z12029.1', 'X52700.1', 'X52701.1', 'X52702.1', 'X52706.1', 'X52703.1', 'X52704.1', 'X52705.1', 'X53811.1', 'X53812.1', 'X53813.1', 'X53814.1', 'U13103.1', 'U13080.1', 'X60495.1', 'X60496.1', 'X60497.1', 'X60498.1', 'Z11996.1', 'X57170.1', 'X60960.1', 'NM_174233.2', 'X67213.1', 'X67214.1', 'X13736.1', 'X05087.1', 'X05090.1', 'X63475.1', 'X63474.1', 'X03454.1', 'X56933.1', 'X63592.1', 'X15802.1', 'X05218.1', 'NM_176613.2', 'X05605.1', 'X16978.1', 'NM_176670.2', 'NM_175822.2', 'X69084.1', 'X56685.1', 'X56119.1', 'M55158.1', 'X57765.1', 'X63139.1', 'X52582.1', 'X52581.1', 'X14710.1', 'X64126.1', 'X64125.1', 'X05274.1', 'NM_174292.2', 'X63681.1', 'X63683.1', 'X63680.1', 'X63684.1', 'X63682.1', 'X67333.1', 'X03590.1', 'X00565.1', 'X06359.1', 'NM_181029.2', 'X14906.1', 'X14907.1', 'X14908.1', 'NM_173899.2', 'X00673.1', 'X04012.1', 'X55489.1', 'X04823.1', 'NM_174421.2', 'NM_001001440.2', 'X04298.1', 'NM_175830.1', 'NM_175810.2', 'NM_176652.2', 'NM_175800.2', 'NM_205817.1', 'NM_176655.2', 'NM_175828.2', 'X63209.1', 'NM_176667.2', 'NM_175829.2', 'NM_175791.2', 'NM_175787.2', 'NM_176660.2', 'NM_175815.2', 'NM_176659.2', 'NM_174564.2', 'X63223.1', 'X63224.1', 'X63208.1', 'X02420.1', 'X15112.1', 'X56857.1', 'NM_176674.2', 'X15235.1', 'X15725.1', 'X58823.1', 'X07436.1', 'X01036.1', 'NM_174837.2', 'X13617.1', 'NM_174630.2', 'X14478.1', 'NM_174043.2', 'Z18244.1', 'V00108.1', 'V00109.1', 'NM_174313.2', 'X16577.1', 'NM_173911.2', 'V00110.1', 'NM_173914.2', 'NM_177512.2', 'NM_174324.2', 'X00376.1', 'X70059.1', 'X13684.1', 'V00111.1', 'X03404.1', 'NM_177516.1', 'NM_175778.2', 'X52318.1']

small_lib = os.path.join(cfg.DIR_REF, 'nt_small.fasta')

if __name__ == '__main__':
    acc_set = set(accs)
    with open(cfg.FILE_REF, 'r') as f, open(small_lib, 'w') as fw:
        fetch_current = False
        for line in f:
            if len(acc_set) == 0:
                break
            if line.startswith(cfg.HEADER_PREFIX):
                mobj = cfg.RX_ACC.search(line)
                if mobj is None:
                    print('Error: could not extract accession from ', line)
                    sys.exit()
                else:
                    acc = mobj.group(1)
                    if acc in acc_set:
                        fetch_current = True
                        acc_set.remove(acc)
                    else:
                        fetch_current = False

            if fetch_current:
                fw.write(line)
    print('Output written to ', small_lib)
    os.system('head {}'.format(small_lib))
